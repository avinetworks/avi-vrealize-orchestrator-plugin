package com.avi.avi.model;

import java.io.BufferedReader;
import java.io.Closeable;
import java.io.DataOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.Base64;

public class session {
	public String createAviObject(String controllerIP, String username, String password, String objectType, String data) throws IOException {
		try {
		   //String postURL = "http://"+controllerIP + "/api/"+objectType+"/";
		   String postURL = "http://10.10.28.108/api/pool/";
	       URL url = new URL(postURL);
	       //String creds = username + ":" + password; 
	       String creds = "admin:avi123$%"; 
	       String encoding = Base64.getEncoder().encodeToString((creds).getBytes("UTF-8"));
	       HttpURLConnection con = (HttpURLConnection) url.openConnection();
	       con.setRequestMethod("POST");
	       con.setRequestProperty("Content-Type", "application/json");
	       con.setRequestProperty("X-Avi-Version", "18.2.3");
	       con.setRequestProperty("Authorization", "Basic " + encoding);

	       con.setDoOutput(true);

	       // Send data of object
	       this.sendData(con, data);
	       
	       // Read response from REST call 
	       return this.read(con.getInputStream());
	       
		} catch (IOException exception) {
			return exception.toString();
		}
	   }
	   
	   protected void sendData(HttpURLConnection con, String data) throws IOException {
	       DataOutputStream wr = null;
	       try {
	           wr = new DataOutputStream(con.getOutputStream());
	           wr.writeBytes(data);
	           wr.flush();
	           wr.close();
	       } catch(IOException exception) {
	           throw exception;
	       } finally {
	           this.closeQuietly(wr);
	       }
	   }

	   private String read(InputStream is) throws IOException {
	       BufferedReader in = null;
	       String inputLine;
	       StringBuilder body;
	       try {
	           in = new BufferedReader(new InputStreamReader(is));

	           body = new StringBuilder();

	           while ((inputLine = in.readLine()) != null) {
	               body.append(inputLine);
	           }
	           in.close();

	           return body.toString();
	       } catch(IOException ioe) {
	           throw ioe;
	       } finally {
	           this.closeQuietly(in);
	       }
	   }

	   protected void closeQuietly(Closeable closeable) {
	       try {
	           if( closeable != null ) {
	               closeable.close();
	           }
	       } catch(IOException ex) {

	       }
	   }
	   public boolean deleteAviObject(String controllerIP, String username, String password, String objectType, String uuid) throws IOException {
	        try {
	           String postURL = "http://"+controllerIP + "/api/"+objectType+"/"+ uuid;
	           URL url = new URL(postURL);
	           String creds = username + ":" + password; 
	           String encoding = Base64.getEncoder().encodeToString((creds).getBytes("UTF-8"));
	           HttpURLConnection con = (HttpURLConnection) url.openConnection();
	           con.setRequestMethod("DELETE");
	           con.setRequestProperty("X-Avi-Version", "18.2.3");
	           con.setRequestProperty("Authorization", "Basic " + encoding);

	           con.setDoOutput(true);
	           
	           return true;

	        } catch (IOException exception) {
	            return false;
	        }
	   }
}